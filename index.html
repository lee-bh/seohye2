<!DOCTYPE html>
<html lang="ko">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>타이포잔치 아카이브 Typography Archive</title>
    <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
    <div class="header">
        <h1>타이포잔치 아카이브</h1>
        <div class="header-years">
            <h2 data-year="2001">2001</h2>
            <h2 data-year="2011">2011</h2>
            <h2 data-year="2013">2013</h2>
            <h2 data-year="2015">2015</h2>
            <h2 data-year="2017">2017</h2>
            <h2 data-year="2019">2019</h2>
            <h2 data-year="2021">2021</h2>
            <h2 data-year="2023">2023</h2>
        </div>
    </div>

    <div class="container">
        <div class="filters">
            <div class="filter-group">
                <select id="yearFilter" class="filter-select">
                    <option value="">All time</option>
                    <option value="2001">2001</option>
                    <option value="2011">2011</option>
                    <option value="2013">2013</option>
                    <option value="2015">2015</option>
                    <option value="2017">2017</option>
                    <option value="2019">2019</option>
                    <option value="2021">2021</option>
                    <option value="2023">2023</option>
                </select>
            </div>
            
            <div class="filter-group">
                <select id="countryFilter" class="filter-select">
                    <option value="">All country</option>
                    <option value="한국">Korea</option>
                    <option value="일본">Japan</option>
                    <option value="중국">China</option>
                </select>
            </div>
            
            <div class="filter-group">
                <input type="text" id="searchInput" class="search-input" placeholder="Search">
            </div>
            
            <div class="thumbnail-controls">
                <input type="range" id="sizeSlider" class="size-slider" min="270" max="500" value="270">
                <div id="sizeDisplay" class="size-display">270px</div>
            </div>
        </div>

        <div id="stats" class="stats" style="display: none;">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <div id="loading" class="loading">
            로딩 중... Loading...
        </div>
        
        <div id="gallery" class="gallery" style="display: none;">
            <!-- Gallery items will be populated by JavaScript -->
        </div>
        
        <div id="noResults" class="no-results" style="display: none;">
            검색 결과가 없습니다.
        </div>
        
        <div id="error" class="error" style="display: none;">
            데이터를 불러올 수 없습니다. JSON 파일을 확인해주세요.
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content" id="modalContent">
            <div class="modal-image-container">
                <img id="modalImage" src="" alt="" class="modal-image">
            </div>
            <div class="modal-text" id="modalText">
                <div class="modal-designer" id="modalDesigner"></div>
                <div class="modal-title" id="modalTitle"></div>
                <div class="modal-meta" id="modalMeta"></div>
            </div>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];
        let thumbnailSize = 270; // Default thumbnail size in pixels

        // Get full image path based on year
        function getFullImagePath(item) {
            if (item.yr === 2001) {
                return `img/2001/${item.file}`;
            } else if (item.yr === 2011) {
                return `img/2011/${item.file}`;
            } else if (item.yr === 2013) {
                return `img/2013/${item.file}`;
            } else if (item.yr === 2015) {
                return `img/2015/${item.file}`;
            } else if (item.yr === 2017) {
                return `img/2017/${item.file}`;
            } else if (item.yr === 2019) {
                return `img/2019/${item.file}`;
            } else if (item.yr === 2021) {
                return `img/2021/${item.file}`;
            } else if (item.yr === 2023) {
                return `img/2023/${item.file}`;
            }
            return `img/noimage.jpg`;
        }

        // Modal functions
        function showModal(imageSrc, title, designer, year, country) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalDesigner = document.getElementById('modalDesigner');
            const modalTitle = document.getElementById('modalTitle');
            const modalMeta = document.getElementById('modalMeta');
            
            modalImage.src = imageSrc;
            modalImage.alt = title;
            modalDesigner.textContent = designer;
            modalTitle.textContent = title;
            modalMeta.textContent = `${year}, ${country}`;
            
            modal.classList.add('show');
            modal.style.display = 'block';
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function hideModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            modal.style.display = 'none';
            
            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        async function loadAllData() {
            const loadingEl = document.getElementById('loading');
            const galleryEl = document.getElementById('gallery');
            const errorEl = document.getElementById('error');
            const statsEl = document.getElementById('stats');

            try {
                // Load all eight JSON files
                const [response2001, response2011, response2013, response2015, response2017, response2019, response2021, response2023] = await Promise.all([
                    fetch('js/2001.json'),
                    fetch('js/2011.json'),
                    fetch('js/2013.json'),
                    fetch('js/2015.json'),
                    fetch('js/2017.json'),
                    fetch('js/2019.json'),
                    fetch('js/2021.json'),
                    fetch('js/2023.json')
                ]);

                if (!response2001.ok || !response2011.ok || !response2013.ok || !response2015.ok || !response2017.ok || !response2019.ok || !response2021.ok || !response2023.ok) {
                    throw new Error('Network response was not ok');
                }

                const [data2001, data2011, data2013, data2015, data2017, data2019, data2021, data2023] = await Promise.all([
                    response2001.json(),
                    response2011.json(),
                    response2013.json(),
                    response2015.json(),
                    response2017.json(),
                    response2019.json(),
                    response2021.json(),
                    response2023.json()
                ]);

                // Combine all data
                allData = [...data2001, ...data2011, ...data2013, ...data2015, ...data2017, ...data2019, ...data2021, ...data2023];
                filteredData = [...allData];

                loadingEl.style.display = 'none';
                galleryEl.style.display = 'grid';
                //statsEl.style.display = 'block';
                

                // Set initial gallery size
                updateGallerySize();
                renderGallery();
                updateStats();

            } catch (error) {
                console.error('Error loading gallery:', error);
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
            }
        }

        function renderGallery() {
            const galleryEl = document.getElementById('gallery');
            const noResultsEl = document.getElementById('noResults');
            
            // Check if elements exist before proceeding
            if (!galleryEl || !noResultsEl) {
                console.error('Gallery or noResults element not found');
                return;
            }
            
            // Clear existing items
            galleryEl.innerHTML = '';

            if (filteredData.length === 0) {
                noResultsEl.style.display = 'block';
                return;
            }

            noResultsEl.style.display = 'none';

            // Create gallery items
            filteredData.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'item';
                
                // Determine image path based on year
                let imagePath;
                if (item.yr === 2001) {
                    imagePath = `img/thumb/2001-thumb/${item.file}`;
                } else if (item.yr === 2011) {
                    imagePath = `img/thumb/2011-thumb/${item.file}`;
                } else if (item.yr === 2013) {
                    imagePath = `img/thumb/2013-thumb/${item.file}`;
                } else if (item.yr === 2015) {
                    imagePath = `img/thumb/2015-thumb/${item.file}`;
                } else if (item.yr === 2017) {
                    imagePath = `img/thumb/2017-thumb/${item.file}`;
                } else if (item.yr === 2019) {
                    imagePath = `img/thumb/2019-thumb/${item.file}`;
                } else if (item.yr === 2021) {
                    imagePath = `img/thumb/2021-thumb/${item.file}`;
                } else if (item.yr === 2023) {
                    imagePath = `img/thumb/2023-thumb/${item.file}`;
                }
                
                itemEl.innerHTML = `
                    <div class="item-image-container">
                        <img src="${imagePath}" alt="${item.title}" class="item-image" 
                             onerror="this.src='img/noimage.jpg'"
                             data-full-image="${getFullImagePath(item)}"
                             data-title="${item.title}"
                             data-designer="${item.designer}"
                             data-year="${item.yr}"
                             data-country="${item.country}">
                    </div>
                    <div class="item-content">
                        <div class="item-designer">${item.designer}</div>
                        <div class="item-title">${item.title}</div>
                        <span class="item-country">${item.yr}, ${item.country}</span>
                    </div>
                `;
                
                galleryEl.appendChild(itemEl);
            });

            // Add click event listeners to all thumbnail images
            const thumbnailImages = document.querySelectorAll('.item-image');
            thumbnailImages.forEach(img => {
                img.style.cursor = 'pointer';
                img.addEventListener('click', function() {
                    const fullImageSrc = this.getAttribute('data-full-image');
                    const title = this.getAttribute('data-title');
                    const designer = this.getAttribute('data-designer');
                    const year = this.getAttribute('data-year');
                    const country = this.getAttribute('data-country');
                    showModal(fullImageSrc, title, designer, year, country);
                });
            });
        }

        function updateStats() {
            const statsEl = document.getElementById('stats');
            
            // Check if element exists before proceeding
            if (!statsEl) {
                console.error('Stats element not found');
                return;
            }
            
            const totalItems = allData.length;
            const displayedItems = filteredData.length;
            const yearCounts = {};
            const countryCounts = {};

            // Count by year and country
            filteredData.forEach(item => {
                yearCounts[item.yr] = (yearCounts[item.yr] || 0) + 1;
                countryCounts[item.country] = (countryCounts[item.country] || 0) + 1;
            });

            const yearText = Object.entries(yearCounts)
                .sort((a, b) => a[0] - b[0])
                .map(([year, count]) => `${year}년 ${count}개`)
                .join(', ');

            const countryText = Object.entries(countryCounts)
                .map(([country, count]) => `${country} ${count}개`)
                .join(', ');

            statsEl.innerHTML = `
                <strong>총 ${totalItems}개 작품 중 ${displayedItems}개 표시</strong><br>
                년도별: ${yearText} | 나라별: ${countryText}
            `;
        }

        function filterData() {
            const yearFilter = document.getElementById('yearFilter').value;
            const countryFilter = document.getElementById('countryFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredData = allData.filter(item => {
                const matchesYear = !yearFilter || item.yr.toString() === yearFilter;
                const matchesCountry = !countryFilter || item.country === countryFilter;
                const matchesSearch = !searchTerm || 
                    item.designer.toLowerCase().includes(searchTerm) ||
                    item.title.toLowerCase().includes(searchTerm);

                return matchesYear && matchesCountry && matchesSearch;
            });

            renderGallery();
            updateStats();
        }

        function clearFilters() {
            const yearFilter = document.getElementById('yearFilter');
            const countryFilter = document.getElementById('countryFilter');
            const searchInput = document.getElementById('searchInput');
            
            if (yearFilter) yearFilter.value = '';
            if (countryFilter) countryFilter.value = '';
            if (searchInput) searchInput.value = '';
            
            // Remove active class from all header year elements
            const headerYears = document.querySelectorAll('.header-years h2');
            headerYears.forEach(el => el.classList.remove('active'));
            
            filteredData = [...allData];
            renderGallery();
            updateStats();
        }

        function updateGallerySize() {
            const galleryEl = document.getElementById('gallery');
            if (galleryEl) {
                galleryEl.style.setProperty('--item-size', thumbnailSize + 'px');
                
                // 썸네일 크기에 따라 갭 조정
                if (thumbnailSize <= 250) {
                    galleryEl.style.gap = '1rem 2rem';
                    galleryEl.classList.add('small-thumbnails');
                } else if (thumbnailSize <= 350) {
                    galleryEl.style.gap = '1.5rem 4rem';
                    galleryEl.classList.remove('small-thumbnails');
                } else {
                    galleryEl.style.gap = '2rem 8rem';
                    galleryEl.classList.remove('small-thumbnails');
                }
            }
        }

        function updateThumbnailSize() {
            const sizeSlider = document.getElementById('sizeSlider');
            const sizeDisplay = document.getElementById('sizeDisplay');
            
            if (sizeSlider && sizeDisplay) {
                thumbnailSize = parseInt(sizeSlider.value);
                sizeDisplay.textContent = thumbnailSize + 'px';
                updateGallerySize();
            }
        }

        // Event listeners - wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load the gallery when the page loads
            loadAllData();
            
            // Add event listeners after DOM is ready
            const yearFilter = document.getElementById('yearFilter');
            const countryFilter = document.getElementById('countryFilter');
            const searchInput = document.getElementById('searchInput');
            const clearFilters = document.getElementById('clearFilters');
            const sizeSlider = document.getElementById('sizeSlider');
            
            if (yearFilter) yearFilter.addEventListener('change', filterData);
            if (countryFilter) countryFilter.addEventListener('change', filterData);
            if (searchInput) searchInput.addEventListener('input', filterData);
            if (clearFilters) clearFilters.addEventListener('click', clearFilters);
            if (sizeSlider) sizeSlider.addEventListener('input', updateThumbnailSize);

            // Modal event listeners
            const modal = document.getElementById('imageModal');
            const modalOverlay = document.getElementById('modalOverlay');
            const modalClose = document.getElementById('modalClose');
            const modalContent = document.getElementById('modalContent');

            // Close modal when clicking anywhere on the modal (overlay)
            if (modal) {
                modal.addEventListener('click', function(e) {
                    // Close if clicking on the modal background or overlay
                    if (e.target === modal || e.target === modalOverlay) {
                        hideModal();
                    }
                });
            }
            
            // Close modal when clicking close button
            if (modalClose) {
                modalClose.addEventListener('click', function(e) {
                    e.stopPropagation();
                    hideModal();
                });
            }

            // Close modal when clicking on the image
            const modalImage = document.getElementById('modalImage');
            if (modalImage) {
                modalImage.addEventListener('click', function(e) {
                    e.stopPropagation();
                    hideModal();
                });
            }

            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal && modal.style.display === 'block') {
                    hideModal();
                }
            });

            // Header h1 click event (reload page)
            const headerH1 = document.querySelector('.header h1');
            if (headerH1) {
                headerH1.style.cursor = 'pointer';
                headerH1.addEventListener('click', function() {
                    window.location.reload();
                });
            }

            // Header year click events
            const headerYears = document.querySelectorAll('.header-years h2');
            headerYears.forEach(yearElement => {
                yearElement.style.cursor = 'pointer';
                yearElement.addEventListener('click', function() {
                    const year = this.getAttribute('data-year');
                    const yearFilter = document.getElementById('yearFilter');
                    if (yearFilter) {
                        yearFilter.value = year;
                        filterData();
                        
                        // Remove active class from all year elements
                        headerYears.forEach(el => el.classList.remove('active'));
                        // Add active class to clicked element
                        this.classList.add('active');
                    }
                });
            });
        });
    </script>
    </body>
</html>